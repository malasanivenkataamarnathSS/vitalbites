<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Profile Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">üîç Quick Profile Error Debug</h1>
        
        <div class="bg-gray-800 p-4 rounded-lg mb-4">
            <h2 class="text-lg font-semibold mb-3">Test localStorage Data</h2>
            <button id="setupMockData" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-700">
                Setup Mock Data
            </button>
            <button id="testProfilePage" class="bg-green-600 px-4 py-2 rounded hover:bg-green-700 ml-2">
                Test Profile Functions
            </button>
        </div>

        <div class="bg-gray-800 p-4 rounded-lg mb-4">
            <h2 class="text-lg font-semibold mb-3">Console Output</h2>
            <div id="output" class="bg-gray-900 p-3 rounded text-sm font-mono h-32 overflow-y-auto"></div>
        </div>

        <div class="text-center">
            <a href="frontend/profile.html" class="bg-orange-600 px-6 py-3 rounded-lg hover:bg-orange-700 inline-block">
                üöÄ Open Profile Page
            </a>
        </div>
    </div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            output.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '\n';
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }

        document.getElementById('setupMockData').addEventListener('click', function() {
            // Clear any existing data first
            localStorage.clear();
            
            // Set up minimal required data
            localStorage.setItem('token', 'mock-token-123');
            localStorage.setItem('username', 'John Doe');
            localStorage.setItem('userEmail', 'john@vitalbites.com');
            localStorage.setItem('userMobile', '+91 9876543210');
            
            log('‚úÖ Mock data setup complete');
            log('Token: ' + localStorage.getItem('token'));
            log('Username: ' + localStorage.getItem('username'));
            log('Email: ' + localStorage.getItem('userEmail'));
        });

        document.getElementById('testProfilePage').addEventListener('click', async function() {
            log('üß™ Testing profile page functions...');
            
            try {
                // Simulate the profile page initialization
                log('Testing fallback function...');
                
                // Test data initialization
                let userProfile = null;
                let orders = [];
                let addresses = [];
                let favorites = [];
                
                log('Arrays initialized');
                
                // Test fallback function (copy from profile.html)
                function fallbackToLocalStorage() {
                    try {
                        log("Falling back to localStorage data");
                        const username = localStorage.getItem('username');
                        const userEmail = localStorage.getItem('userEmail');
                        const userMobile = localStorage.getItem('userMobile');
                        
                        log("localStorage values: " + JSON.stringify({username, userEmail, userMobile}));
                        
                        const defaultName = username || 'User';
                        const defaultEmail = userEmail || 'No email provided';
                        
                        userProfile = {
                            name: defaultName,
                            email: defaultEmail,
                            phone: userMobile || '',
                            joinDate: new Date().toISOString()
                        };
                        
                        log('‚úÖ Fallback successful: ' + JSON.stringify(userProfile));
                        return true;
                    } catch (error) {
                        log('‚ùå Fallback error: ' + error.message);
                        return false;
                    }
                }
                
                // Test updateStats function
                function updateStats() {
                    try {
                        const orderCount = orders ? orders.length : 0;
                        const spentAmount = orders ? orders.reduce((sum, order) => sum + (order.total || 0), 0) : 0;
                        const addressCount = addresses ? addresses.length : 0;
                        
                        let joinYear = new Date().getFullYear();
                        if (userProfile && userProfile.joinDate) {
                            const joinDate = new Date(userProfile.joinDate);
                            if (!isNaN(joinDate.getTime())) {
                                joinYear = joinDate.getFullYear();
                            }
                        }
                        
                        log('‚úÖ Stats updated: Orders=' + orderCount + ', Spent=' + spentAmount + ', Addresses=' + addressCount + ', Year=' + joinYear);
                        return true;
                    } catch (error) {
                        log('‚ùå updateStats error: ' + error.message);
                        return false;
                    }
                }
                
                // Run tests
                const fallbackResult = fallbackToLocalStorage();
                const statsResult = updateStats();
                
                if (fallbackResult && statsResult) {
                    log('üéâ All tests passed! Profile page should work.');
                } else {
                    log('‚ö†Ô∏è Some tests failed. Check the errors above.');
                }
                
            } catch (error) {
                log('‚ùå Test failed: ' + error.message);
                log('Stack: ' + error.stack);
            }
        });

        // Initialize
        log('üîß Profile debug tool ready');
        log('Click "Setup Mock Data" then "Test Profile Functions"');
    </script>
</body>
</html>
